# 📈 股票模块 API 接口文档

接口前缀：`/api/stocks`

---

## 1️⃣ 获取全量股票快照

**GET** `/api/stocks`

**说明：** 获取全市场所有股票快照（用于大盘刷新、缓存比对）

**请求参数：**

| 参数 | 类型 | 是否必传 | 说明 |
|------|------|----------|------|
| version | string | 否 | 客户端缓存版本，服务端如一致则返回 `updated: false` |

**返回示例：**

```json
{
  "updated": true,
  "version": "2025-04-23-16:10",
  "data": [
    { "code": "sh600519", "name": "贵州茅台", "price": 1888.33, "change": "3.15" }
  ]
}
```

---

## 2️⃣ 获取热门推荐股票

**GET** `/api/stocks/hot`

**说明：** 获取当前涨幅前 20 的热门股票，用于首页推荐、榜单展示

**返回示例：**

```json
{
  "version": "2025-04-23-16:10",
  "data": [
    { "code": "sh600519", "name": "贵州茅台", "price": 1888.33, "change": "3.15" }
  ]
}
```

---

## 3️⃣ 获取行业板块股票列表

**GET** `/api/stocks/industry/:name`

**说明：** 获取某个行业下的所有股票快照（按板块分类）

**路径参数：**

| 参数 | 类型 | 示例 | 说明 |
|------|------|------|------|
| name | string | tech, finance | 行业英文 key（symbols_all.js 中定义） |

**返回示例：**

```json
{
  "version": "2025-04-23-16:10",
  "data": [
    { "code": "sz000001", "name": "平安银行", "price": 10.23, "change": "-0.03" }
  ]
}
```

---

## 4️⃣ 获取单个股票详情

**GET** `/api/stocks/:code/detail`

**说明：** 获取某只股票的当前快照详情。首次访问将触发实时抓取并缓存，后续 10 分钟内命中本地缓存文件，无需再次请求数据源。

**路径参数：**

| 参数 | 类型 | 示例 | 说明 |
|------|------|------|------|
| code | string | sh600519 | 股票代码（A股/港股/美股） |

**返回示例：**

```json
{
  "version": "2025-04-23-16:05",
  "data": {
    "code": "sh600519",
    "name": "贵州茅台",
    "price": 1888.33,
    "change": "3.15",
    "open": 1865.00,
    "previousClose": 1855.12,
    "high": 1899.00,
    "low": 1855.50,
    "volume": 421000,
    "amount": 7894300.00,
    "time": "15:00:03",
    "news": []
  }
}
```

---

## 5️⃣ 获取股票 K 线图数据

**GET** `/api/stocks/:code/kline`

**说明：** 获取某支股票的历史K线图数据。首次请求会拉取并缓存数据文件，后续命中本地缓存（按 `code-period-range` 文件分隔）。

**路径参数：**

| 参数 | 类型 | 示例 | 说明 |
|------|------|------|------|
| code | string | sh600519 | 股票代码 |

**查询参数：**

| 参数 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| period | string | day | 可选：day/week/month |
| range | string | 1y | 可选：1y/6m/3m 等 |

**返回示例：**

```json
{
  "code": "sh600519",
  "period": "day",
  "range": "1y",
  "data": [
    ["2025-04-01", 1850, 1860, 1830, 1880, 320000]
  ]
}
```

---

## 6️⃣ 获取股票相关新闻（链接）

**GET** `/api/stocks/:code/news`

**说明：** 获取该股票的相关新闻链接。接口会抓取 Quark 搜索结果，提取标题与跳转链接，首次请求写入本地缓存，缓存有效期为 5 分钟。

**路径参数：**

| 参数 | 类型 | 示例 | 说明 |
|------|------|------|------|
| code | string | sh600519 | 股票代码（用于搜索） |

**返回示例：**

```json
[
  {
    "title": "贵州茅台净利增长超预期",
    "url": "https://finance.sina.com.cn/news/xyz",
    "time": "2025-04-23 14:12",
    "source": "Quark搜索",
    "summary": ""
  }
]
```

---

## 🛡️ 缓存机制说明（用户访问触发懒加载 + 本地缓存）

| 接口 | 缓存路径 | 缓存机制 |
|------|-----------|-----------|
| 全量快照 | `cache/stock_cache.json` | 定时更新，每10分钟由任务写入 |
| 行业快照 | `cache/industry/:name.json` | 定时更新，由任务管理 |
| 热门榜单 | `cache/hot.json` | 定时更新，由任务管理 |
| 股票详情 | `cache/detail/:code.json` | 首次访问时拉取并缓存，有效期10分钟 |
| K线图 | `cache/kline/:code-period-range.json` | 首次访问拉取并缓存，无需重复拉 |
| 新闻流 | `cache/news/:code.json` | 用户请求时拉取并缓存，5分钟内有效 |

---