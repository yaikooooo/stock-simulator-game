// æ•°æ®ç»“æ„å®šä¹‰æ–‡ä»¶ schema.prisma
// ç”¨äº SQLite æ•°æ®åº“ï¼Œæ”¯æŒç”¨æˆ·ä¿¡æ¯ã€èº«ä»½ç»‘å®šã€è´¦æˆ·èµ„äº§ã€è‚¡ç¥¨æŒä»“

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

//
// ğŸ§ ç”¨æˆ·ä¸»è¡¨ - User
// æ¯ä¸ªæ³¨å†Œç”¨æˆ·ä¸€æ¡ï¼Œç”¨äºå­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼ˆå¤´åƒ/æ˜µç§°ï¼‰ï¼ŒåŒæ—¶æŒ‚æ¥èµ„äº§ä¸èº«ä»½ç»‘å®š
//
model User {
  id        String   @id @default(cuid())       // ç”¨æˆ·å”¯ä¸€ IDï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
  uniqueId  String   @unique                    // ä¸»é”®(å•ç‹¬ä¿å­˜8ä½IDï¼Œä¾›å¤–éƒ¨å±•ç¤º)
  nickname  String                              // æ˜µç§°
  avatar    String?                             // å¤´åƒ URLï¼Œå¯ä¸ºç©º
  createdAt DateTime @default(now())            // åˆ›å»ºæ—¶é—´
  updatedAt DateTime @updatedAt                 // æœ€è¿‘æ›´æ–°æ—¶é—´
  bindings  AuthBinding[]                       // ç¬¬ä¸‰æ–¹å¹³å°ç»‘å®šè®°å½•ï¼ˆå¾®ä¿¡ã€æŠ–éŸ³ã€æ‰‹æœºå·ï¼‰
  accounts  Account[]                           // ç”¨æˆ·èµ„äº§è´¦æˆ·åˆ—è¡¨ï¼ˆé€šå¸¸ä¸€æ¡ï¼‰
  holdings  Holding[]                           // å½“å‰æŒä»“è®°å½•ï¼ˆå¤šåªè‚¡ç¥¨ï¼‰
  trades Trade[]                                // ç”¨æˆ·çš„æ‰€æœ‰äº¤æ˜“è®°å½•
}

//
// ğŸ” ç¬¬ä¸‰æ–¹ç™»å½•ä¸èº«ä»½ç»‘å®šè¡¨ - AuthBinding
// è®°å½•ç”¨æˆ·ç»‘å®šçš„å¤–éƒ¨èº«ä»½ï¼šå¾®ä¿¡/æŠ–éŸ³/æ‰‹æœºå·/åŒèŠ±é¡º/é›ªçƒç­‰ï¼Œæ”¯æŒåŸ‹ç‚¹/è½¬åŒ–è·Ÿè¸ª
//
model AuthBinding {
  id          String   @id @default(cuid())      // ï¼ˆPrismaè‡ªåŠ¨ç”Ÿæˆçš„IDï¼‰
  userId      String                             // ä¸»é”®(å•ç‹¬ä¿å­˜8ä½IDï¼Œä¾›å¤–éƒ¨å±•ç¤º)
  provider    String                             // å¹³å°ç±»å‹ï¼šwechat / douyin / phone / tonghuashun ...
  externalId  String                             // å¹³å°ç”¨æˆ·å”¯ä¸€æ ‡è¯†ï¼ˆopenidï¼‰
  phone       String                             // æ‰‹æœºå·
  bindingType String   @default("auth")          // ç”¨é€”ï¼šauthï¼ˆç”¨äºç™»å½•ï¼‰/ intentï¼ˆæ„å‘ï¼‰/ convertedï¼ˆå·²è½¬åŒ–ï¼‰
  metadata    Json?                              // é™„åŠ ä¿¡æ¯ï¼ˆæ¸ é“æ¥æºç­‰ï¼‰
  createdAt   DateTime @default(now())           // ç»‘å®šæ—¶é—´

  user User @relation(fields: [userId], references: [id])

  @@unique([provider, externalId])               // æ¯ä¸ªå¹³å°ç”¨æˆ·åªèƒ½ç»‘å®šä¸€æ¬¡
}

//
// ğŸ’° ç”¨æˆ·è´¦æˆ·èµ„äº§è¡¨ - Account
// æ¯ä¸ªç”¨æˆ·ä¸€ä¸ªè´¦æˆ·ï¼Œè®°å½•å½“å‰ä½™é¢ä¸æ€»èµ„äº§ï¼ˆå«æŒä»“ï¼‰ï¼Œåç»­ç”¨äºæ’è¡Œæ¦œä¸åˆ†æ
//
model Account {
  id         String   @id @default(cuid())       // ï¼ˆPrismaè‡ªåŠ¨ç”Ÿæˆçš„IDï¼‰
  userId     String                              // ä¸»é”®(å•ç‹¬ä¿å­˜8ä½IDï¼Œä¾›å¤–éƒ¨å±•ç¤º)
  balanceCNY Float                               // äººæ°‘å¸ä½™é¢ï¼ˆé»˜è®¤ï¼‰
  balanceUSD Float                               // ç¾å…ƒä½™é¢
  balanceEUR Float                               // æ¬§å…ƒä½™é¢
  totalValue Float                               // æ€»èµ„äº§ï¼ˆå«æŒä»“ä»·å€¼ï¼‰
  updatedAt  DateTime @updatedAt                 // æ›´æ–°æ—¶é—´

  user User @relation(fields: [userId], references: [id])
}

//
// ğŸ“¦ ç”¨æˆ·æŒä»“è®°å½•è¡¨ - Holding
// è®°å½•æ¯ä½ç”¨æˆ·å½“å‰æŒæœ‰çš„æ¯åªè‚¡ç¥¨ï¼ˆä»£ç ã€è‚¡æ•°ã€ä¹°å…¥å‡ä»·ï¼‰ï¼Œç”¨äºè®¡ç®—ç›ˆäºä¸å±•ç¤º
//
model Holding {
  id        String   @id @default(cuid())        // ï¼ˆPrismaè‡ªåŠ¨ç”Ÿæˆçš„IDï¼‰
  userId    String                               // ä¸»é”®(å•ç‹¬ä¿å­˜8ä½IDï¼Œä¾›å¤–éƒ¨å±•ç¤º)
  code      String                               // è‚¡ç¥¨ä»£ç ï¼ˆå¦‚ sh600519ï¼‰
  name      String                               // è‚¡ç¥¨åç§°ï¼ˆå¦‚ è´µå·èŒ…å°ï¼‰
  amount    Int                                  // æŒæœ‰è‚¡æ•°
  price     Float                                // ä¹°å…¥å‡ä»·
  createdAt DateTime @default(now())             // åˆ›å»ºæ—¶é—´
  updatedAt DateTime @updatedAt                  // æ›´æ–°æ—¶é—´

  user User @relation(fields: [userId], references: [id])
  @@unique([userId, code])                       // æ¯äººæ¯è‚¡ç¥¨æœ€å¤šä¸€æ¡æŒä»“è®°å½•
}

//
// ğŸ“¦ ç”¨æˆ·äº¤æ˜“è®°å½•è¡¨ - Trade
// è®°å½•ç”¨æˆ·æ¯ä¸€ç¬”äº¤æ˜“æ“ä½œï¼šä¹°å…¥ / å–å‡º / åˆ’è½¬ç­‰
//
model Trade {
  id        String   @id @default(cuid())          // ï¼ˆPrismaè‡ªåŠ¨ç”Ÿæˆçš„IDï¼‰
  userId    String                                 // ä¸»é”®(å•ç‹¬ä¿å­˜8ä½IDï¼Œä¾›å¤–éƒ¨å±•ç¤º)
  code      String                                 // è‚¡ç¥¨ä»£ç 
  name      String                                 // è‚¡ç¥¨åç§°
  type      String                                 // ç±»å‹ï¼šbuy / sell / transfer
  price     Float                                  // å•ä»·
  amount    Int                                    // æ•°é‡ï¼ˆä¹°å…¥ä¸ºæ­£ï¼Œå–å‡ºä¸ºè´Ÿï¼‰
  fee       Float?                                 // æ‰‹ç»­è´¹ï¼ˆå¯é€‰ï¼‰
  createdAt DateTime @default(now())               // åˆ›å»ºæ—¶é—´

  user User @relation(fields: [userId], references: [id])
}
